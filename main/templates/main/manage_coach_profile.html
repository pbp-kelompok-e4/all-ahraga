{% extends "base.html" %}

{% block title %}Kelola Profil Pelatih{% endblock title %}

{% block content %}
<style>
    /* Styling untuk form inputs, diganti dengan kelas utilitas Tailwind */
    
    /* Menggunakan placeholder CSS untuk memastikan styling form-input dari Django tetap dapat diatur */
    .form-input-style {
        @apply block w-full p-3 md:p-4 border border-gray-300 rounded-lg bg-gray-50 text-base text-gray-700 transition-all duration-200;
    }

    .form-input-style:focus {
        @apply border-teal-500 bg-white outline-none ring-4 ring-teal-100;
    }

    form textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    /* Styling untuk file input */
    input[type="file"] {
        @apply block w-full p-2 text-sm text-gray-600 border border-gray-300 rounded-lg bg-gray-50 cursor-pointer;
    }

    input[type="file"]::file-selector-button {
        @apply px-4 py-2 mr-4 border-none rounded-md bg-gray-600 text-white font-semibold text-sm cursor-pointer transition-colors duration-200 hover:bg-gray-700;
    }

    /* Styling untuk error messages */
    .errorlist {
        @apply list-none p-0 mt-1 space-y-0.5;
    }

    .errorlist li {
        @apply text-red-600 text-sm;
    }

    /* Styling untuk help text */
    .helptext {
        @apply block text-xs text-gray-500 mt-1;
    }
</style>

<div class="relative min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto mb-6">
        <a href="{% url 'coach_profile' %}" 
           class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700 transition duration-200 shadow-md">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Kembali ke Profil
        </a>
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-teal-600 to-teal-800 px-8 py-10 text-center rounded-t-3xl">
            <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-2">
                Kelola Profil Pelatih
            </h1>
            <p class="text-teal-200 text-base">
                Perbarui informasi profesional Anda
            </p>
        </div>

        <div class="p-8 md:p-12">
            {% if coach_profile and coach_profile.profile_picture %}
            <div class="flex justify-center mb-10">
                <div class="relative">
                    <img src="{{ coach_profile.profile_picture.url }}" 
                         alt="Foto Profil" 
                         class="w-32 h-32 rounded-full object-cover border-4 border-teal-300 shadow-xl">
                    <div class="absolute bottom-0 right-0 bg-teal-600 rounded-full p-2 shadow-xl border-2 border-white">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                </div>
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" class="space-y-8">
                {% csrf_token %}

                {% if form.non_field_errors %}
                <div class="bg-red-50 border border-red-300 rounded-xl p-4">
                    {% for error in form.non_field_errors %}
                    <p class="text-red-800 text-sm font-semibold">{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for field in form %}
                    {% if field.name != 'profile_picture_url' %}
                    <div class="form-group {% if field.name == 'experience_desc' or field.name == 'service_areas' %}md:col-span-2{% endif %}">
                        <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ field.label }}
                            {% if field.field.required %}
                            <span class="text-red-500">*</span>
                            {% endif %}
                        </label>
                        {{ field|attr:'class:form-input-style' }}
                        {% if field.help_text %}
                        <p class="helptext">{{ field.help_text }}</p>
                        {% endif %}
                        {% if field.errors %}
                        <ul class="errorlist">
                            {% for error in field.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    {% endif %}
                    {% endfor %}

                    <div class="form-group md:col-span-2">
                        <label for="{{ form.profile_picture_url.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
                            {{ form.profile_picture_url.label }}
                        </label>
                        {{ form.profile_picture_url|attr:'class:form-input-style' }}
                        {% if form.profile_picture_url.help_text %}
                        <p class="helptext">{{ form.profile_picture_url.help_text }}</p>
                        {% endif %}
                        {% if form.profile_picture_url.errors %}
                        <ul class="errorlist">
                            {% for error in form.profile_picture_url.errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>

                <div class="pt-6 border-t border-gray-200">
                    <button type="submit" 
                            class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3.5 px-6 rounded-xl shadow-xl transition duration-200 focus:outline-none focus:ring-4 focus:ring-teal-200 text-lg flex items-center justify-center transform hover:scale-[1.005]">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="max-w-4xl mx-auto mt-6 text-center">
        <p class="text-sm text-gray-500">
            <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Pastikan semua informasi yang Anda masukkan akurat dan terkini
        </p>
    </div>
</div>

{# TOAST container (hidden by default) #}
<div id="mc-toast" aria-live="polite" class="hidden fixed right-6 bottom-6 z-[9999] min-w-[280px] rounded-xl p-4 text-white shadow-2xl transition-all duration-300"></div>

<script>
    document.addEventListener('DOMContentLoaded', function(){
        // build messages array from Django messages (if any)
        var django_messages = [{% for message in messages %} {
            message: "{{ message|escapejs }}",
            tags: "{{ message.tags }}"
        }{% if not forloop.last %}, {% endif %}{% endfor %}];

        if (!django_messages || django_messages.length === 0) return;

        var toast = document.getElementById('mc-toast');

        function showToast(text, type){
            var bg = 'bg-gradient-to-r from-blue-600 to-blue-800'; // info
            var icon = 'ℹ️';
            if (type === 'success') { bg = 'bg-gradient-to-r from-green-600 to-green-800'; icon = '✅'; }
            if (type === 'error')   { bg = 'bg-gradient-to-r from-red-600 to-red-800'; icon = '❌'; }

            toast.className = 'fixed right-6 bottom-6 z-[9999] min-w-[280px] rounded-xl p-4 text-white shadow-2xl transition-all duration-300 ' + bg;
            toast.innerHTML = '<div class="flex gap-3 items-center">' +
                              '<div class="text-xl">' + icon + '</div>' +
                              '<div class="font-bold text-base leading-tight">' + text + '</div>' +
                              '</div>';
            
            toast.classList.remove('hidden');
            toast.style.opacity = '0';
            
            setTimeout(function(){ toast.style.opacity = '1'; }, 20);
            setTimeout(function(){ toast.style.opacity = '0'; }, 3200);
            setTimeout(function(){ toast.classList.add('hidden'); }, 3600);
        }

        // show all messages sequentially
        (function showSequential(i){
            if (i >= django_messages.length) return;
            var m = django_messages[i];
            var type = 'info';
            if (m.tags.indexOf('success') !== -1) type = 'success';
            if (m.tags.indexOf('error') !== -1) type = 'error';
            showToast(m.message, type);
            setTimeout(function(){ showSequential(i+1); }, 1800);
        })(0);
    });
</script>
{% endblock content %}