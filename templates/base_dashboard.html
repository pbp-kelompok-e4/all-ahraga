{% load static %}
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | {% block title %}{% endblock title %}</title> 

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Poppins', 'sans-serif']
          }
        }
      }
    }
  </script>

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <style>
    [x-cloak] { display: none !important; }
    
    /* Sidebar Transitions */
    .sidebar {
      transition: transform 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .content-area {
      transition: padding-left 300ms cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Menu Item Styling */
    .menu-item { 
      position: relative; 
      overflow: hidden; 
    }
    
    .menu-item::before {
      content: ''; 
      position: absolute; 
      left: 0; 
      top: 0;
      height: 100%; 
      width: 3px;
      background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
      transform: scaleY(0); 
      transition: transform 0.3s ease;
    }
    
    .menu-item.active::before,
    .menu-item:hover::before { 
      transform: scaleY(1); 
    }
    
    .logo-gradient {
      background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Backdrop Blur */
    .backdrop-overlay {
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
  </style>
  
  {% block extra_head %}{% endblock extra_head %}
</head>

<body class="bg-gray-50 min-h-screen font-sans">
  
  <div 
    x-data="{ desktopOpen: true, mobileOpen: false }" 
    @keydown.escape.window="mobileOpen = false"
    class="flex min-h-screen"
  >
    
    <!-- Sidebar -->
    <aside 
      id="sidebar" 
      class="sidebar bg-white shadow-xl border-r border-gray-100 min-h-screen flex flex-col fixed inset-y-0 left-0 z-30 w-64 lg:w-auto"
      :class="{
        'translate-x-0': mobileOpen, 
        '-translate-x-full': !mobileOpen,
        'lg:translate-x-0': true,
        'lg:w-64': desktopOpen, 
        'lg:w-20': !desktopOpen
      }"
      x-cloak
    >
      <!-- Logo Header -->
      <div class="h-16 flex items-center justify-between px-6 border-b border-gray-100 flex-shrink-0">
        
        <a 
          href="{% url 'index' %}" 
          class="flex items-center space-x-3"
        >
          <div class="w-10 h-10 bg-gradient-to-br from-teal-500 to-teal-700 rounded-xl flex items-center justify-center shadow-md flex-shrink-0">
            <i class="fa-solid fa-futbol text-white"></i>
          </div>
          <h1 
            class="text-2xl font-bold logo-gradient whitespace-nowrap"
            x-show="desktopOpen || mobileOpen"
            x-transition 
          >
            All-Ahraga
          </h1>
        </a>
        
        <button 
          @click.stop="mobileOpen = false"
          class="lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors"
          x-show="mobileOpen"
        >
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>

      </div>

      <!-- Navigation -->
      <nav class="flex-1 p-6 space-y-2 overflow-y-auto">
        {% if user.is_authenticated and user.profile %}
          {% if user.is_superuser or user.is_staff %}
            <div class="menu-item rounded-xl">
              <a href="{% url 'admin_dashboard' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-tachometer-alt w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Admin Dashboard</span> 
              </a>
            </div>
            <div class="menu-item rounded-xl">
              <a href="/admin/" target="_blank" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-cogs w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Django Admin</span> 
              </a>
            </div>

          {% elif user.profile.is_venue_owner %}
            <div class="menu-item rounded-xl">
              <a href="{% url 'venue_dashboard' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-store w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Manage Venue</span> 
              </a>
            </div>
            <div class="menu-item rounded-xl">
              <a href="{% url 'venue_revenue' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-chart-line w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Revenue Report</span> 
              </a>
            </div>

          {% elif user.profile.is_coach %}
            <div class="menu-item rounded-xl">
              <a href="{% url 'coach_list' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-users w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Daftar Pelatih</span> 
              </a>
            </div>
            <div class="menu-item rounded-xl">
              <a href="{% url 'coach_revenue_report' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-file-invoice-dollar w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Laporan</span> 
              </a>
            </div>
            <div class="menu-item rounded-xl">
              <a href="{% url 'coach_schedule' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-calendar-alt w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Jadwal Kamu</span> 
              </a>
            </div>
            <div class="menu-item rounded-xl">
              <a href="{% url 'coach_profile' %}" class="flex items-center px-4 py-3 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-xl transition-all" :class="{ 'justify-center': !desktopOpen && !mobileOpen, 'space-x-3': desktopOpen || mobileOpen }">
                <i class="fa-solid fa-user w-5 text-center text-gray-500 flex-shrink-0"></i>
                <span class="font-medium whitespace-nowrap" x-show="desktopOpen || mobileOpen" x-transition>Profil Kamu</span> 
              </a>
            </div>
          {% endif %}
        {% endif %}
      </nav>

      <!-- Footer -->
      <div class="p-6 border-t border-gray-100 mt-auto" :class="{ 'text-center': !desktopOpen && !mobileOpen }">
         <span class="text-xs text-gray-400" x-show="desktopOpen || mobileOpen" x-transition>Â© 2025 All-Ahraga</span> 
      </div> 
    </aside>

    <!-- Mobile Backdrop -->
    <div 
      x-show="mobileOpen" 
      @click="mobileOpen = false" 
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-20 bg-black/50 backdrop-overlay lg:hidden" 
      style="display: none;"
      x-cloak
    ></div>

    <!-- Main Content Area -->
    <div 
      class="content-area flex-1 flex flex-col w-full"
      :class="{ 'lg:pl-64': desktopOpen, 'lg:pl-20': !desktopOpen }"
    >
      
      <!-- Header -->
      <header class="h-16 bg-white shadow-sm border-b border-gray-200 px-4 sm:px-6 sticky top-0 z-10 flex items-center">
        <div class="flex items-center justify-between w-full">
          
          <div class="flex items-center space-x-3 sm:space-x-4">
            <!-- Desktop Toggle -->
            <button 
              @click="desktopOpen = !desktopOpen" 
              class="hidden lg:block p-2 rounded-lg hover:bg-gray-100 transition-colors"
              title="Toggle sidebar"
            >
              <i class="fa-solid" :class="desktopOpen ? 'fa-chevron-left' : 'fa-chevron-right'" class="text-gray-600"></i>
            </button>
            
            <!-- Mobile Burger -->
            <button 
              @click="mobileOpen = !mobileOpen" 
              class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
              aria-label="Toggle menu"
            >
              <i class="fa-solid fa-bars text-gray-600"></i>
            </button>
            
            <!-- Page Title -->
            <h2 class="text-lg sm:text-2xl font-semibold text-gray-900">
              {% block page_title %}Dashboard{% endblock page_title %}
            </h2>
          </div>
          
          <!-- User Menu -->
          {% if user.is_authenticated %}
          <div class="relative" x-data="{ openUser: false }">
            <button 
              @click="openUser = !openUser" 
              class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors"
            >
              <span class="w-8 h-8 bg-gradient-to-br from-teal-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                <span class="text-white font-semibold text-xs">{{ user.username|slice:":2"|upper }}</span>
              </span>
              <span class="hidden md:block text-sm font-medium text-gray-700">{{ user.username }}</span>
              <i class="fa-solid fa-chevron-down text-xs text-gray-400 hidden md:block"></i>
            </button>
            
            <div 
              x-show="openUser" 
              @click.away="openUser = false" 
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5"
              style="display: none;"
              x-cloak
            >
              <div class="px-4 py-2 text-sm text-gray-500 border-b">
                Masuk sebagai <strong class="text-gray-900">{{ user.username }}</strong>
              </div>
              <a href="{% url 'logout' %}" 
                 class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-600 transition">
                 <i class="fa-solid fa-right-from-bracket w-4 h-4 mr-2"></i>
                 Keluar
              </a>
            </div>
          </div>
          {% endif %}
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 bg-gray-50 px-4 py-6 sm:px-6 md:px-8 lg:px-12 xl:px-16">
        <div class="max-w-7xl mx-auto">
          {% if messages %}
            <div class="mb-6 space-y-3">
              {% for message in messages %}
                <div class="p-4 rounded-lg shadow-sm border text-sm sm:text-base
                  {% if message.tags == 'success' %}bg-green-100 text-green-700 border-green-200
                  {% elif message.tags == 'error' %}bg-red-100 text-red-700 border-red-200
                  {% else %}bg-blue-100 text-blue-700 border-blue-200{% endif %}">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
          {% block content %}{% endblock content %}
        </div>
      </main>
    </div>
  </div>

  {% block extra_js %}{% endblock extra_js %}
</body>
</html>